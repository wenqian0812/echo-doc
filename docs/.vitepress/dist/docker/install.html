<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Echo</title>
    <meta name="description" content="echo的程序笔记">
    <meta name="generator" content="VitePress v1.0.0-rc.44">
    <link rel="preload stylesheet" href="/echo-doc/assets/style.U-nXW-An.css" as="style">
    
    <script type="module" src="/echo-doc/assets/app.CukHDFtp.js"></script>
    <link rel="preload" href="/echo-doc/assets/inter-roman-latin.Bu8hRsVA.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/echo-doc/assets/chunks/framework.mlmjWbz3.js">
    <link rel="modulepreload" href="/echo-doc/assets/chunks/theme.B9IeNwJU.js">
    <link rel="modulepreload" href="/echo-doc/assets/docker_install.md.C0C8Ggky.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-734217b9><!--[--><!--]--><!--[--><span tabindex="-1" data-v-f78c1263></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-f78c1263> Skip to content </a><!--]--><!----><header class="VPNav" data-v-734217b9 data-v-3e0201d8><div class="VPNavBar has-sidebar" data-v-3e0201d8 data-v-6586a85a><div class="wrapper" data-v-6586a85a><div class="container" data-v-6586a85a><div class="title" data-v-6586a85a><div class="VPNavBarTitle has-sidebar" data-v-6586a85a data-v-29285982><a class="title" href="/echo-doc/" data-v-29285982><!--[--><!--]--><!----><span data-v-29285982>Echo</span><!--[--><!--]--></a></div></div><div class="content" data-v-6586a85a><div class="content-body" data-v-6586a85a><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6586a85a><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6586a85a data-v-cf62cc71><span id="main-nav-aria-label" class="visually-hidden" data-v-cf62cc71>Main Navigation</span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-cf62cc71 data-v-0b717c22><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-0b717c22><span class="text" data-v-0b717c22><!----><span data-v-0b717c22>front</span><span class="vpi-chevron-down text-icon" data-v-0b717c22></span></span></button><div class="menu" data-v-0b717c22><div class="VPMenu" data-v-0b717c22 data-v-77498765><div class="items" data-v-77498765><!--[--><!--[--><div class="VPMenuLink" data-v-77498765 data-v-db5680d9><a class="VPLink link" href="/echo-doc/web/lint/index.html" data-v-db5680d9><!--[-->代码规范<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-77498765 data-v-db5680d9><a class="VPLink link" href="/echo-doc/web/code/js/center.html" data-v-db5680d9><!--[-->示例代码<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-77498765 data-v-db5680d9><a class="VPLink link" href="/echo-doc/web/question/readme.html" data-v-db5680d9><!--[-->面试题<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/echo-doc/ubuntu/readme.html" tabindex="0" data-v-cf62cc71 data-v-d4814e7a><!--[--><span data-v-d4814e7a>ubuntu</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/echo-doc/centos/readme.html" tabindex="0" data-v-cf62cc71 data-v-d4814e7a><!--[--><span data-v-d4814e7a>centos</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/echo-doc/windows/readme.html" tabindex="0" data-v-cf62cc71 data-v-d4814e7a><!--[--><span data-v-d4814e7a>windows</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/echo-doc/docker/readme.html" tabindex="0" data-v-cf62cc71 data-v-d4814e7a><!--[--><span data-v-d4814e7a>docker</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/echo-doc/git/readme.html" tabindex="0" data-v-cf62cc71 data-v-d4814e7a><!--[--><span data-v-d4814e7a>git</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/echo-doc/other/readme.html" tabindex="0" data-v-cf62cc71 data-v-d4814e7a><!--[--><span data-v-d4814e7a>other</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6586a85a data-v-6196c97b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-6196c97b data-v-79322c52 data-v-8e9c72b5><span class="check" data-v-8e9c72b5><span class="icon" data-v-8e9c72b5><!--[--><span class="vpi-sun sun" data-v-79322c52></span><span class="vpi-moon moon" data-v-79322c52></span><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-6586a85a data-v-f8fe37b2 data-v-0b717c22><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-0b717c22><span class="vpi-more-horizontal icon" data-v-0b717c22></span></button><div class="menu" data-v-0b717c22><div class="VPMenu" data-v-0b717c22 data-v-77498765><!----><!--[--><!--[--><!----><div class="group" data-v-f8fe37b2><div class="item appearance" data-v-f8fe37b2><p class="label" data-v-f8fe37b2>Appearance</p><div class="appearance-action" data-v-f8fe37b2><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-f8fe37b2 data-v-79322c52 data-v-8e9c72b5><span class="check" data-v-8e9c72b5><span class="icon" data-v-8e9c72b5><!--[--><span class="vpi-sun sun" data-v-79322c52></span><span class="vpi-moon moon" data-v-79322c52></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6586a85a data-v-fb186f55><span class="container" data-v-fb186f55><span class="top" data-v-fb186f55></span><span class="middle" data-v-fb186f55></span><span class="bottom" data-v-fb186f55></span></span></button></div></div></div></div><div class="divider" data-v-6586a85a><div class="divider-line" data-v-6586a85a></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-734217b9 data-v-e01d0f74><div class="container" data-v-e01d0f74><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-e01d0f74><span class="vpi-align-left menu-icon" data-v-e01d0f74></span><span class="menu-text" data-v-e01d0f74>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-e01d0f74 data-v-2688044d><button data-v-2688044d>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-734217b9 data-v-3a058ca6><div class="curtain" data-v-3a058ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-3a058ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-3a058ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-3a058ca6><section class="VPSidebarItem level-0 has-active" data-v-3a058ca6 data-v-f683597b><div class="item" role="button" tabindex="0" data-v-f683597b><div class="indicator" data-v-f683597b></div><h2 class="text" data-v-f683597b>docker</h2><!----></div><div class="items" data-v-f683597b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-f683597b data-v-f683597b><div class="item" data-v-f683597b><div class="indicator" data-v-f683597b></div><a class="VPLink link link" href="/echo-doc/docker/readme.html" data-v-f683597b><!--[--><p class="text" data-v-f683597b>overview</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f683597b data-v-f683597b><div class="item" data-v-f683597b><div class="indicator" data-v-f683597b></div><a class="VPLink link link" href="/echo-doc/docker/install.html" data-v-f683597b><!--[--><p class="text" data-v-f683597b>install</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f683597b data-v-f683597b><div class="item" data-v-f683597b><div class="indicator" data-v-f683597b></div><a class="VPLink link link" href="/echo-doc/docker/docker-compose.html" data-v-f683597b><!--[--><p class="text" data-v-f683597b>docker-compose</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f683597b data-v-f683597b><div class="item" data-v-f683597b><div class="indicator" data-v-f683597b></div><a class="VPLink link link" href="/echo-doc/docker/gitlab.html" data-v-f683597b><!--[--><p class="text" data-v-f683597b>gitlab</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f683597b data-v-f683597b><div class="item" data-v-f683597b><div class="indicator" data-v-f683597b></div><a class="VPLink link link" href="/echo-doc/docker/mysql.html" data-v-f683597b><!--[--><p class="text" data-v-f683597b>mysql</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f683597b data-v-f683597b><div class="item" data-v-f683597b><div class="indicator" data-v-f683597b></div><a class="VPLink link link" href="/echo-doc/docker/rabbitmq.html" data-v-f683597b><!--[--><p class="text" data-v-f683597b>rabbitmq</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f683597b data-v-f683597b><div class="item" data-v-f683597b><div class="indicator" data-v-f683597b></div><a class="VPLink link link" href="/echo-doc/docker/redis.html" data-v-f683597b><!--[--><p class="text" data-v-f683597b>redis</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-734217b9 data-v-7a1aa57b><div class="VPDoc has-sidebar has-aside" data-v-7a1aa57b data-v-7208151a><!--[--><!--]--><div class="container" data-v-7208151a><div class="aside" data-v-7208151a><div class="aside-curtain" data-v-7208151a></div><div class="aside-container" data-v-7208151a><div class="aside-content" data-v-7208151a><div class="VPDocAside" data-v-7208151a data-v-842ce547><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-842ce547 data-v-663e5535><div class="content" data-v-663e5535><div class="outline-marker" data-v-663e5535></div><div class="outline-title" role="heading" aria-level="2" data-v-663e5535>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-663e5535><span class="visually-hidden" id="doc-outline-aria-label" data-v-663e5535> Table of Contents for current page </span><ul class="VPDocOutlineItem root" data-v-663e5535 data-v-837e4f9f><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-842ce547></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-7208151a><div class="content-container" data-v-7208151a><!--[--><!--]--><main class="main" data-v-7208151a><div style="position:relative;" class="vp-doc _echo-doc_docker_install" data-v-7208151a><div><h2 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -fsSL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://get.docker.com </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bash</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker --mirror Aliyun</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [arch=arm64] https://mirrors.aliyun.com/docker-ce/linux/debian buster stable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; &gt; /etc/apt/sources.list.d/docker.list</span></span></code></pre></div><h2 id="加速器" tabindex="-1">加速器 <a class="header-anchor" href="#加速器" aria-label="Permalink to &quot;加速器&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -fsSL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://get.docker.com </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bash</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker --mirror Aliyun</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl enable docker</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkdir -p /etc/docker</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee /etc/docker/daemon.json </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;registry-mirrors&quot;: [&quot;https://2r522sjx.mirror.aliyuncs.com&quot;],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;log-driver&quot;:&quot;json-file&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;log-opts&quot;: {&quot;max-size&quot;:&quot;1024m&quot;}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl daemon-reload</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl restart docker</span></span></code></pre></div><h2 id="迁移方案" tabindex="-1">迁移方案 <a class="header-anchor" href="#迁移方案" aria-label="Permalink to &quot;迁移方案&quot;">​</a></h2><p>两种方法迁移 Docker 的默认安装(存储)目录 如果是通过 Ubuntu 的 apt-get 安装的 Docker，默认的安装目录应该是：/var/lib/docker。</p><p>为了完全确定，可以使用以下的命令查询真正的安装路径：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>sudo docker info | grep &quot;Docker Root Dir&quot;</span></span></code></pre></div><p>前置工作 下文以 /store/software/docker 这个路径作为要迁移的新 Docker 安装(存储)目录</p><p>在开始迁移之前，首先复制原 Docker 安装(存储)目录到新的路径下：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>cp -a /var/lib/docker /store/software/</span></span></code></pre></div><p>然后备份原目录数据：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>mv -u /var/lib/docker /var/lib/docker.bak</span></span></code></pre></div><h3 id="方法一-软链接" tabindex="-1">方法一：软链接 <a class="header-anchor" href="#方法一-软链接" aria-label="Permalink to &quot;方法一：软链接&quot;">​</a></h3><p>通过把 Docker 的原安装(存储)目录移动到自定义的其他路径下，然后在原位置下建立软链接是最简单快捷的方式。</p><p>首先，关停 Docker 服务：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>sudo systemctl stop docker</span></span>
<span class="line"><span># or</span></span>
<span class="line"><span>sudo service docker stop</span></span></code></pre></div><p>接着，新建一个 /var/lib/docker 的软链：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>sudo ln -fs /store/software/docker /var/lib/docker</span></span></code></pre></div><p>最后，重启 Docker 服务：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>sudo systemctl start docker</span></span>
<span class="line"><span># or</span></span>
<span class="line"><span>sudo service docker start</span></span></code></pre></div><p>启动 Docker 之后，以后你 pull image 和 run container，Docker 写入的路径依然是 /var/lib/docker，但是因为软链的设置，实际已经是往新的目录写入了。至此，完成了 Docker 安装(存储) 目录的迁移。</p><h3 id="方法二-直接修改-docker-配置文件" tabindex="-1">方法二：直接修改 Docker 配置文件 <a class="header-anchor" href="#方法二-直接修改-docker-配置文件" aria-label="Permalink to &quot;方法二：直接修改 Docker 配置文件&quot;">​</a></h3><p>Docker 版本 &lt; v17.05.0 因为 dockerd 运行 Docker 服务的时候可以通过参数 graph 指定镜像和容器存放路径，比如：–graph=/var/lib/docker，我们只需要修改配置文件指定启动参数即可。</p><p>Docker 的配置文件可以设置大部分的后台进程参数，在各个操作系统中的存放位置不一致，在 Ubuntu 中的位置是：/etc/default/docker，在 CentOS 中的位置是：/etc/sysconfig/docker。</p><ul><li><p>如果是 CentOS 则添加下面这行： OPTIONS=--graph=&quot;/store/software/docker&quot; --selinux-enabled -H fd://</p></li><li><p>如果是 Ubuntu 则添加下面这行（因为 Ubuntu 默认没开启 selinux）： OPTIONS=--graph=&quot;/store/software/docker&quot; -H fd://</p></li><li><p>或者 DOCKER_OPTS=&quot;-g /store/software/docker&quot; Docker 版本 &gt;= v17.05.0 因为 Docker 官方在这个发行版本就 deprecated 了 graph 这个 feature，所以如果你机器上安装的 Docker 版本 &gt;= v17.05.0，则无法通过在 /etc/default/docker 配置文件中指定 graph 参数来修改 Docker 的默认安装(存储)目录了，具体参见官网文档：Docker Docs。</p></li></ul><p>好在天无绝人之路，新版本的 Docker 还有其他方式可以达到我们修改安装(存储)目录的目的：通过修改(新建)/etc/docker/daemon.json，指定 data-root 参数的值。</p><p>按如下操作：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>vim /etc/docker/daemon.json</span></span></code></pre></div><p>加入</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>{</span></span>
<span class="line"><span>    &quot;data-root&quot;: &quot;/store/software/docker&quot;,</span></span>
<span class="line"><span>    &quot;storage-driver&quot;: &quot;overlay2&quot; # 这个是 Docker 是默认设置，这里也可以不用加</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>重启 Docker &amp; 清理原安装(存储)目录 最后，重启 Docker 服务：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>sudo systemctl restart docker</span></span>
<span class="line"><span># or</span></span>
<span class="line"><span>sudo service docker restart</span></span></code></pre></div><p>通过上述任一方法完成迁移之后，在确认 Docker 能正常工作之后，删除备份的原目录数据：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/docker.bak</span></span></code></pre></div><h3 id="迁移方案参考链接" tabindex="-1">迁移方案参考链接 <a class="header-anchor" href="#迁移方案参考链接" aria-label="Permalink to &quot;迁移方案参考链接&quot;">​</a></h3><p><a href="https://ld246.com/article/1566017283738" target="_blank" rel="noreferrer">https://ld246.com/article/1566017283738</a></p><h2 id="docker镜像的导入导出" tabindex="-1">docker镜像的导入导出 <a class="header-anchor" href="#docker镜像的导入导出" aria-label="Permalink to &quot;docker镜像的导入导出&quot;">​</a></h2><p>一、使用 export 和 import 1，查看本机的容器 这两个命令是通过容器来导入、导出镜像。首先我们使用 docker ps -a 命令查看本机所有的容器。</p><p>2，导出镜像 （1）使用 docker export 命令根据容器 ID 将镜像导出成一个文件。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> export f299f501774c</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hangger_server.tar</span></span></code></pre></div><p>（2）上面命令执行后，可以看到文件已经保存到当前的 docker 终端目录下。</p><p>3，导入镜像 （1）使用 docker import 命令则可将这个镜像文件导入进来。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> import - new_hangger_server </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hangger_server.tar</span></span></code></pre></div><p>（2）执行 docker images 命令可以看到镜像确实已经导入进来了。</p><p>二、使用 save 和 load</p><p>1，查看本机的容器 这两个命令是通过镜像来保存、加载镜像文件的。首先我们使用 docker images 命令查看本机所有的镜像。</p><p>2，保存镜像</p><p>（1）下面使用 docker save 命令根据 ID 将镜像保存成一个文件。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> save </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">fdf2b4c26d3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hangge_server.tar</span></span></code></pre></div><p>（2）我们还可以同时将多个 image 打包成一个文件，比如下面将镜像库中的 postgres 和 mongo 打包：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> save -o images.tar postgres:9.6 mongo:3.4</span></span></code></pre></div><p>3，载入镜像 使用 docker load 命令则可将这个镜像文件载入进来。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> load </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hangge_server.tar</span></span></code></pre></div><p>附：两种方案的差别 特别注意：两种方法不可混用。 如果使用 import 导入 save 产生的文件，虽然导入不提示错误，但是启动容器时会提示失败，会出现类似&quot;docker: Error response from daemon: Container command not found or does not exist&quot;的错误。</p><p>1，文件大小不同</p><p>export 导出的镜像文件体积小于 save 保存的镜像</p><p>是否可以对镜像重命名</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> import 可以为镜像指定新名称</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> load 不能对载入的镜像重命名</span></span></code></pre></div><p>3，是否可以同时将多个镜像打包到一个文件中</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> export 不支持</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> save 支持</span></span></code></pre></div><p>4，是否包含镜像历史</p><p>export 导出（import 导入）是根据容器拿到的镜像，再导入时会丢失镜像所有的历史记录和元数据信息（即仅保存容器当时的快照状态），所以无法进行回滚操作。 而 save 保存（load 加载）的镜像，没有丢失镜像的历史，可以回滚到之前的层（layer）。</p><p>5，应用场景不同</p><p>docker export 的应用场景：</p><blockquote><p>主要用来制作基础镜像，比如我们从一个 ubuntu 镜像启动一个容器，然后安装一些软件和进行一些设置后，使用 docker export 保存为一个基础镜像。然后，把这个镜像分发给其他人使用，比如作为基础的开发环境。</p></blockquote><p>docker save 的应用场景：</p><blockquote><p>如果我们的应用是使用 docker-compose.yml 编排的多个镜像组合，但我们要部署的客户服务器并不能连外网。这时就</p></blockquote></div></div></main><footer class="VPDocFooter" data-v-7208151a data-v-8724bd9e><!--[--><!--]--><!----><nav class="prev-next" data-v-8724bd9e><div class="pager" data-v-8724bd9e><a class="VPLink link pager-link prev" href="/echo-doc/docker/readme.html" data-v-8724bd9e><!--[--><span class="desc" data-v-8724bd9e>Previous page</span><span class="title" data-v-8724bd9e>overview</span><!--]--></a></div><div class="pager" data-v-8724bd9e><a class="VPLink link pager-link next" href="/echo-doc/docker/docker-compose.html" data-v-8724bd9e><!--[--><span class="desc" data-v-8724bd9e>Next page</span><span class="title" data-v-8724bd9e>docker-compose</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"web_lint_html.md\":\"DKAac5lI\",\"git_rebase.md\":\"DS_1O8hU\",\"index.md\":\"CbC9dZdJ\",\"web_lint_vue.md\":\"CXXHNNYm\",\"other_linux-disk.md\":\"D33nkNmG\",\"docker_docker-compose.md\":\"DCT7eNIH\",\"uos_readme.md\":\"D35N5XeC\",\"git_gitignore.md\":\"CkS2ttGr\",\"uos_docker-install.md\":\"D89d4lh3\",\"centos_centos7.6-nginx1.12.md\":\"Dtx2mHlh\",\"web_question_vue.md\":\"0vs9G6iZ\",\"web_index.md\":\"Cj0aEz7T\",\"windows_win10-close-port.md\":\"BNijH8mE\",\"windows_readme.md\":\"DHspkrS_\",\"web_code_js_center.md\":\"WCR_K29m\",\"other_ansible.md\":\"B-0C7TwV\",\"web_lint_index.md\":\"g-R6sJQl\",\"git_tag.md\":\"DvsuwIy8\",\"web_question_css.md\":\"D80zihyy\",\"git_git_flow.md\":\"BrSMQ67O\",\"ubuntu_clear-history.md\":\"B3OiJXJm\",\"git_branch.md\":\"-2otTN2J\",\"web_code_js_common.md\":\"fzyJ5ijB\",\"web_code_js_flat-array-to-tree.md\":\"P4YlZWYC\",\"git_readme.md\":\"BMerEXFK\",\"other_flink.md\":\"BwSywMam\",\"docker_redis.md\":\"CXMdk-mS\",\"docker_readme.md\":\"CIvn0lJn\",\"other_kafka.md\":\"YDZNPiQW\",\"git_migration.md\":\"CxC18Nhk\",\"centos_centos7.6-kong.md\":\"Cz3E9BV9\",\"docker_install.md\":\"C0C8Ggky\",\"git_move.md\":\"Ba42UReC\",\"centos_readme.md\":\"O9254aJz\",\"docker_gitlab.md\":\"CRUVxO4_\",\"docker_mysql.md\":\"mEeE29I6\",\"ubuntu_readme.md\":\"BYmyPihc\",\"web_question_html.md\":\"CVrEHdJc\",\"docker_rabbitmq.md\":\"CeRf5hMG\",\"other_readme.md\":\"BC5-zf5Y\",\"web_lint_css.md\":\"BJhr4eV1\",\"web_code_js_div-screenshot.md\":\"CqhIyM-N\",\"other_logstash.md\":\"DDXaKAEQ\",\"web_lint_javascript.md\":\"C7DVoOJM\",\"ubuntu_ubuntu18.04-python3.8.md\":\"CL4fyWEM\",\"web_question_readme.md\":\"DWcxA-77\",\"web_question_js.md\":\"y7w1gXTL\",\"other_jumpserver.md\":\"Majsl5XT\",\"other_ceph.md\":\"DeFmSwQo\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Echo\",\"description\":\"echo的程序笔记\",\"base\":\"/echo-doc/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"front\",\"items\":[{\"text\":\"代码规范\",\"link\":\"/web/lint/index\"},{\"text\":\"示例代码\",\"link\":\"/web/code/js/center\"},{\"text\":\"面试题\",\"link\":\"/web/question/readme\"}]},{\"text\":\"ubuntu\",\"link\":\"/ubuntu/readme\"},{\"text\":\"centos\",\"link\":\"/centos/readme\"},{\"text\":\"windows\",\"link\":\"/windows/readme\"},{\"text\":\"docker\",\"link\":\"/docker/readme\"},{\"text\":\"git\",\"link\":\"/git/readme\"},{\"text\":\"other\",\"link\":\"/other/readme\"}],\"sidebar\":{\"web\":[{\"text\":\"代码规范\",\"items\":[{\"text\":\"vue\",\"link\":\"/web/lint/vue\"},{\"text\":\"html\",\"link\":\"/web/lint/html\"},{\"text\":\"javascript\",\"link\":\"/web/lint/javascript\"},{\"text\":\"css\",\"link\":\"/web/lint/css\"}]},{\"text\":\"代码示例 - JS\",\"items\":[{\"text\":\"公共\",\"link\":\"/web/code/js/common\"},{\"text\":\"图片截图指定区域\",\"link\":\"/web/code/js/div-screenshot\"},{\"text\":\"居中方案\",\"link\":\"/web/code/js/center\"},{\"text\":\"一维数组、树结构相互转换\",\"link\":\"/web/code/js/flat-array-to-tree\"}]},{\"text\":\"面试题\",\"items\":[{\"text\":\"css\",\"link\":\"/web/question/css\"},{\"text\":\"js\",\"link\":\"/web/question/js\"},{\"text\":\"vue\",\"link\":\"/web/question/vue\"},{\"text\":\"html\",\"link\":\"/web/question/html\"}]}],\"git\":[{\"text\":\"git\",\"items\":[{\"text\":\"总览\",\"link\":\"/git/readme\"},{\"text\":\"工作流程\",\"link\":\"/git/git_flow\"},{\"text\":\"branch\",\"link\":\"/git/branch\"},{\"text\":\"迁移\",\"link\":\"/git/migration\"},{\"text\":\"gitignore\",\"link\":\"/git/gitignore\"},{\"text\":\"tag\",\"link\":\"/git/tag\"},{\"text\":\"rebase\",\"link\":\"/git/rebase\"}]}],\"ubuntu\":[{\"text\":\"ubuntu\",\"items\":[{\"text\":\"清除痕迹\",\"link\":\"/ubuntu/clear-history\"},{\"text\":\"ubuntu18.04 安装python3.8\",\"link\":\"/ubuntu/ubuntu18.04-python3.8\"}]}],\"centos\":[{\"text\":\"centos\",\"items\":[{\"text\":\"centos7.6-kong\",\"link\":\"/centos/centos7.6-kong\"},{\"text\":\"centos7.6-nginx1.12\",\"link\":\"/centos/centos7.6-nginx1.12\"}]}],\"windows\":[{\"text\":\"windows\",\"items\":[{\"text\":\"close port\",\"link\":\"/windows/win10-close-port\"}]}],\"docker\":[{\"text\":\"docker\",\"items\":[{\"text\":\"overview\",\"link\":\"/docker/readme\"},{\"text\":\"install\",\"link\":\"/docker/install\"},{\"text\":\"docker-compose\",\"link\":\"/docker/docker-compose\"},{\"text\":\"gitlab\",\"link\":\"/docker/gitlab\"},{\"text\":\"mysql\",\"link\":\"/docker/mysql\"},{\"text\":\"rabbitmq\",\"link\":\"/docker/rabbitmq\"},{\"text\":\"redis\",\"link\":\"/docker/redis\"}]}],\"other\":[{\"text\":\"杂谈\",\"items\":[{\"text\":\"overview\",\"link\":\"/other/readme\"},{\"text\":\"ansible\",\"link\":\"/other/ansible\"},{\"text\":\"ceph\",\"link\":\"/other/ceph\"},{\"text\":\"flink\",\"link\":\"/other/flink\"},{\"text\":\"jumpserver\",\"link\":\"/other/jumpserver\"},{\"text\":\"kafka\",\"link\":\"/other/kafka\"},{\"text\":\"linux-disk\",\"link\":\"/other/linux-disk\"},{\"text\":\"logstash\",\"link\":\"/other/logstash\"}]}]}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>